<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ipoteka krediti</title>
  </head>
  <style>
    input {
      width: 150px;
    }
  </style>
  <body>
    <div style="margin-bottom: 10px">
      <label for="amount" style="display: block"
        >Evin qiyməti: (Kreditin məbləği)</label
      >
      <input
        name="amount"
        placeholder="Məbləği qeyd edin"
        type="number"
        id="amount"
        oninput="handleChange(this.value)"
      />
    </div>

    <div style="margin-bottom: 10px">
      <label for="rate" style="display: block">Faiz: (standart 7)</label>
      <input name="rate" type="number" id="rate" value="7" />
    </div>

    <input type="submit" value="Submit" onclick="handleSubmit()" />
    <p>Evin qiyməti: <span id="sellAmount"></span></p>
    <p>İlkin ödəniş: <span id="firstPayment"></span></p>
    <p>Aylıq ödəniş: <span id="monthlyPayment"></span></p>
    <p>Yekun məbləğ: <span id="totalAmount"></span></p>

    <footer style="text-align: center">
      <p>&copy; 2024 Shukurlu Nahid</p>
    </footer>

    <script>
      const sellAmountEl = document.getElementById("sellAmount");
      const firstPaymentEl = document.getElementById("firstPayment");
      const monthlyPaymentEl = document.getElementById("monthlyPayment");
      const totalAmountEl = document.getElementById("totalAmount");

      function handleChange(val) {
        sellAmountEl.textContent = thousandSeparator(+val);
      }

      function handleSubmit() {
        const amount = document.getElementById("amount").value;
        const rate = document.getElementById("rate").value;

        if (!amount || !rate) {
          alert("Xanaları düzgün doldurun");
          clearResults();
          return;
        }
        const firstPayment = (amount * 15) / 100;
        const monthlyPayment = calculateAnnuity(amount - firstPayment, rate);
        const totalAmount = calculatoTotalAmount(monthlyPayment);
        firstPaymentEl.textContent = thousandSeparator(firstPayment);
        monthlyPaymentEl.textContent = thousandSeparator(monthlyPayment);
        totalAmountEl.textContent = thousandSeparator(totalAmount);
      }

      function calculateAnnuity(amount, rate, month = 300) {
        rate = rate / 100;
        const monthlyRate = rate / 12;
        const fraction = amount * monthlyRate;
        const denominator = 1 - Math.pow(1 + monthlyRate, -1 * month);
        const annuity = fraction / denominator;

        return annuity;
      }

      function calculatoTotalAmount(monthlyPayment, month = 300) {
        let totalAmount = monthlyPayment * month;
        totalAmount = Number(totalAmount.toFixed(2));
        return totalAmount;
      }

      function thousandSeparator(number, fixedNumber = 2) {
        if (!number) {
          return;
        }

        let result = "";

        if (fixedNumber) {
          number = Number(number.toFixed(fixedNumber));
        }
        result = number.toLocaleString("en-US").replace(",", " ");

        return result;
      }

      function clearResults() {
        firstPaymentEl.textContent = "";
        monthlyPaymentEl.textContent = "";
        totalAmountEl.textContent = "";
      }
    </script>
  </body>
</html>
